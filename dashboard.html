<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PeerConnect - Modern Learning Platform</title>

  <!-- SEO (no visual change) -->
  <meta name="description" content="PeerConnect is a modern learning platform where students collaborate, share resources, and learn together.">
  <link rel="canonical" href="https://yourdomain.com/">

  <!-- Fonts & Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">

  <style>
    /* Global Styles (kept) */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #1e2a38 0%, #2c3e50 100%);
      color: #333;
      min-height: 100vh;
      padding-bottom: 80px;
      transition: background 0.3s ease, color 0.3s ease;
    }

    /* Dark mode (kept) */
    body.dark-mode {
      background: linear-gradient(135deg, #1e1e1e 0%, #121212 100%);
      color: #eee;
    }
    body.dark-mode .view-all { color: rgba(255,255,255,0.85); }
    body.dark-mode .dropdown-menu {
      background: #1f1f1f; color: #eee; box-shadow: 0 5px 15px rgba(0,0,0,0.4);
    }
    body.dark-mode .dropdown-menu a {
      color: #eee; border-bottom: 1px solid rgba(255,255,255,0.07);
    }
    body.dark-mode .dropdown-menu a:hover { background: rgba(255,255,255,0.06); }
    body.dark-mode .search-bar input::placeholder { color: rgba(255,255,255,0.8); }

    /* Glass morphism effect (kept) */
    .glass-card {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
    }

    /* Header Styles (kept) */
    .glass-header {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 15px 30px;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .header-content { display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto; }
    .logo { display: flex; align-items: center; gap: 10px; color: white; }
    .logo i { font-size: 28px; }
    .logo h1 { font-weight: 600; font-size: 24px; }
    .header-actions { display: flex; align-items: center; gap: 20px; }

    .search-bar {
      display: flex; align-items: center;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px; padding: 8px 15px;
    }
    .search-bar input {
      background: transparent; border: none; color: white;
      width: 250px; margin-right: 10px;
    }
    .search-bar input::placeholder { color: rgba(255, 255, 255, 0.7); }
    .search-bar button { background: transparent; border: none; color: white; cursor: pointer; }

    .header-icons { display: flex; align-items: center; gap: 15px; }
    .notification-bell { position: relative; color: white; font-size: 20px; cursor: pointer; }
    .badge { position: absolute; top: -5px; right: -5px; width: 8px; height: 8px; background: #ff4757; border-radius: 50%; }

    /* Animations (kept) */
    .fade-in { animation: fadeIn 0.4s ease; }
    @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
    .slide-up { animation: slideUp 0.4s ease; }
    @keyframes slideUp { from {transform: translateY(20px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }
    /* Reduced motion (no visual change) */
    @media (prefers-reduced-motion: reduce) {
      .fade-in, .slide-up { animation: none !important; }
      body { transition: none !important; }
    }

    .dark-toggle { cursor: pointer; font-size: 20px; color: white; }

    .profile-dropdown { position: relative; }
    .profile-pic img { width: 40px; height: 40px; border-radius: 50%; cursor: pointer; }
    .dropdown-menu {
      position: absolute; top: 50px; right: 0;
      background: white; border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      width: 180px; display: none; z-index: 1000;
    }
    .dropdown-menu a {
      display: block; padding: 12px 15px; color: #333; text-decoration: none;
      border-bottom: 1px solid #f1f1f1;
    }
    .dropdown-menu a:hover { background: #f8f9fa; }
    .dropdown-menu a i { margin-right: 8px; color: #667eea; }
    .profile-dropdown:hover .dropdown-menu { display: block; }

    /* Floating Navigation (kept) */
    .floating-nav {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      display: flex; gap: 15px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 12px 20px; border-radius: 50px; z-index: 100;
    }
    .nav-bubble {
      display: flex; flex-direction: column; align-items: center;
      text-decoration: none; color: rgba(255, 255, 255, 0.7);
      padding: 10px 15px; border-radius: 50px; transition: all 0.3s ease;
    }
    .nav-bubble.active, .nav-bubble:hover { background: rgba(255, 255, 255, 0.2); color: white; }
    .nav-bubble i { font-size: 18px; margin-bottom: 4px; }
    .nav-bubble span { font-size: 12px; }

    /* Main Content (kept) */
    .main-content { max-width: 1400px; margin: 30px auto; padding: 0 20px; }

    /* Welcome Card (kept) */
    .welcome-card {
      display: flex; justify-content: space-between; align-items: center;
      padding: 25px 30px; margin-bottom: 30px; color: white;
    }
    .welcome-text h2 { font-weight: 600; margin-bottom: 8px; }
    .highlight { color: #ffd43b; }
    .quick-actions { display: flex; gap: 15px; }
    .action-btn {
      padding: 12px 20px; border: none; border-radius: 50px; font-weight: 500;
      cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease;
    }
    .upload-btn { background: rgba(255, 255, 255, 0.2); color: white; }
    .upload-btn:hover { background: rgba(255, 255, 255, 0.3); }
    .help-btn { background: #4cd137; color: white; }
    .help-btn:hover { background: #44bd32; }

    /* Dashboard Grid (kept) */
    .dashboard-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;
    }
    .card { padding: 20px; color: white; }
    .card-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .card-header h3 { display: flex; align-items: center; gap: 8px; font-weight: 500; }
    .view-all { color: rgba(255, 255, 255, 0.7); font-size: 13px; text-decoration: none; }
    .view-all:hover { color: white; }

    /* Lists (kept & used) */
    .notification-list { display: flex; flex-direction: column; gap: 12px; }
    .notification-item {
      display: flex; align-items: center; gap: 12px;
      padding: 10px; border-radius: 8px; background: rgba(255, 255, 255, 0.1);
    }
    .notification-item i { font-size: 16px; }

    /* Minimal progress bar (fits your style; invisible until data arrives) */
    .progress-meter {
      width: 100%; height: 10px;
      background: rgba(255,255,255,0.12);
      border-radius: 10px; overflow: hidden;
      display: none; /* shown when progress loads */
    }
    .progress-fill {
      height: 100%; width: 0%;
      background: #4cd137; transition: width 0.8s ease;
    }
    #progress-text { margin-top: 8px; opacity: 0.85; }

    /* Empty states (subtle, no layout change) */
    .muted { opacity: 0.85; font-size: 14px; }

    /* FAB (kept) */
    .fab { position: fixed; bottom: 90px; right: 30px; }
    .fab-btn {
      width: 60px; height: 60px; border-radius: 50%; background: #4cd137; color: white;
      border: none; font-size: 20px; cursor: pointer; box-shadow: 0 4px 15px rgba(76, 209, 55, 0.3);
      transition: all 0.3s ease;
    }
    .fab-btn:hover { background: #44bd32; transform: scale(1.05); }

    /* Page Sections (kept) */
    .page-section { display: none; padding: 20px; color: white; }
    .page-section.active { display: block; }

    /* Modal (kept) */
    .page-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.7); z-index: 1000; align-items: center; justify-content: center; }
    .page-modal .modal-content { width: 90%; max-width: 1000px; max-height: 90vh; overflow: hidden; }
    .modal-header {
      display: flex; justify-content: space-between; align-items: center; padding: 15px 20px;
      background: rgba(255, 255, 255, 0.1); border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .modal-header h2 { color: white; font-weight: 500; }
    .modal-close { background: none; border: none; color: white; font-size: 24px; cursor: pointer; }
    .modal-body { padding: 0; height: calc(90vh - 60px); }
    .modal-body iframe { width: 100%; height: 100%; border: none; }

    /* Responsive Design (kept) */
    @media (max-width: 768px) {
      .header-content { flex-direction: column; gap: 15px; }
      .search-bar input { width: 180px; }
      .welcome-card { flex-direction: column; gap: 20px; text-align: center; }
      .quick-actions { justify-content: center; }
      .dashboard-grid { grid-template-columns: 1fr; }
      .floating-nav { bottom: 10px; padding: 10px 15px; }
      .nav-bubble { padding: 8px 12px; }
      .nav-bubble span { display: none; }
    }
  </style>
</head>

<body>
  <!-- Floating Navigation with links (kept) -->
  <div class="floating-nav" role="navigation" aria-label="Primary">
    <a href="#" class="nav-bubble active" data-target="home" aria-label="Home">
      <i class="fas fa-home" aria-hidden="true"></i><span>Home</span>
    </a>
    <a href="#" class="nav-bubble" data-target="discussion-forum" aria-label="Forum">
      <i class="fas fa-comments" aria-hidden="true"></i><span>Forum</span>
    </a>
    <a href="#" class="nav-bubble" id="study-materials-nav" data-target="study-materials" aria-label="Materials">
      <i class="fas fa-book" aria-hidden="true"></i><span>Materials</span>
    </a>
    <a href="#" class="nav-bubble" id="profile-nav" data-target="profile" aria-label="Profile">
      <i class="fas fa-user" aria-hidden="true"></i><span>Profile</span>
    </a>
  </div>

  <!-- Modal Container for Pages (kept) -->
  <div id="page-modal" class="page-modal" aria-modal="true" role="dialog" aria-labelledby="modal-title">
    <div class="modal-content glass-card">
      <div class="modal-header">
        <h2 id="modal-title">User Profile</h2>
        <button class="modal-close" aria-label="Close modal">&times;</button>
      </div>
      <div class="modal-body" id="modal-body">
        <iframe id="profile-frame" src="about:blank" title="Modal content"></iframe>
      </div>
    </div>
  </div>

  <!-- Glass Morphism Header (kept) -->
  <header class="glass-header">
    <div class="header-content">
      <div class="logo">
        <i class="fas fa-book-open" aria-hidden="true"></i>
        <h1>PeerConnect</h1>
      </div>
      <div class="header-actions">
        <div class="search-bar">
          <input type="text" placeholder="Search..." aria-label="Search">
          <button aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></button>
        </div>

        <div class="header-icons">
          <div class="dark-toggle" id="darkToggle" role="button" tabindex="0" aria-label="Toggle dark mode">
            <i class="fas fa-moon" aria-hidden="true"></i>
          </div>

          <div class="notification-bell" id="notificationBell">
            <a href="notification.html" aria-label="Notifications">
              <i class="fas fa-bell" aria-hidden="true"></i>
              <span class="badge" id="notificationBadge"></span>
            </a>
          </div>

          <div class="profile-dropdown">
            <div class="profile-pic">
              <img src="https://ui-avatars.com/api/?name=User+Name&background=3498db&color=fff" alt="Profile">
            </div>
            <div class="dropdown-menu">
              <a href="#" id="profile-dropdown-link"><i class="fas fa-user-circle"></i> Profile</a>
              <a href="#"><i class="fas fa-cog"></i> Settings</a>
              <a href="#"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content Area (kept layout) -->
  <main class="main-content">
    <div id="dashboard" class="tab-content active">
      <div class="welcome-card glass-card">
        <div class="welcome-text">
          <h2>Welcome back, <span id="username">User</span>!</h2>
          <p>Ready to continue your learning journey?</p>
        </div>
        <div class="quick-actions">
          <button class="action-btn upload-btn" id="upload-materials-btn">
            <i class="fas fa-upload" aria-hidden="true"></i> Upload Materials
          </button>
          <button class="action-btn help-btn" id="request-help-btn">
            <i class="fas fa-hands-helping" aria-hidden="true"></i> Request Help
          </button>
        </div>
      </div>

      <div class="dashboard-grid">
        <!-- Notifications Card (kept) -->
        <div class="card glass-card notifications-card">
          <div class="card-header">
            <h3><i class="fas fa-bell" aria-hidden="true"></i> Notifications</h3>
            <a href="notification.html" class="view-all">View All</a>
          </div>
          <div class="notification-list" id="notifications-list" aria-live="polite"></div>
          <p id="notifications-empty" class="muted" style="display:none;">No notifications yet.</p>
        </div>

        <!-- Trending Discussions Card (kept) -->
        <div class="card glass-card">
          <div class="card-header">
            <h3><i class="fas fa-fire" aria-hidden="true"></i> Trending</h3>
            <a href="trending" class="view-all">View All</a>
          </div>
          <div id="trending-list" class="notification-list"></div>
          <p id="trending-empty" class="muted" style="display:none;">No trending discussions yet.</p>
        </div>

        <!-- Recent Resources Card (kept) -->
        <div class="card glass-card">
          <div class="card-header">
            <h3><i class="fas fa-bookmark" aria-hidden="true"></i> Resources</h3>
            <a href="#" class="view-all">View All</a>
          </div>
          <div id="resources-list" class="notification-list"></div>
          <p id="resources-empty" class="muted" style="display:none;">No resources yet.</p>
        </div>

        <!-- Progress Card (kept) -->
        <div class="card glass-card progress-card">
          <div class="card-header">
            <h3><i class="fas fa-chart-line" aria-hidden="true"></i> Your Progress</h3>
          </div>
          <div class="progress-meter" id="progress-meter">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          <p id="progress-text" class="muted">Loading...</p>
        </div>
      </div>
    </div>

    <!-- Page sections (kept) -->
    <div id="home" class="page-section">Welcome to Home</div>
    <div id="discussion-forum" class="page-section">Forum Page</div>
    <div id="study-materials" class="page-section">Study Materials Page</div>
    <div id="profile" class="page-section">Profile Page</div>
  </main>

  <!-- Floating Action Button (kept) -->
  <div class="fab">
    <button class="fab-btn" id="fab-button" aria-label="Add">
      <i class="fas fa-plus" aria-hidden="true"></i>
    </button>
  </div>

  <!-- Scripts -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // ---- Dark Mode (kept) ----
      const darkToggle = document.getElementById('darkToggle');
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
        darkToggle.innerHTML = '<i class="fas fa-sun"></i>';
      }
      const toggleTheme = () => {
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        darkToggle.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
      };
      darkToggle.addEventListener('click', toggleTheme);
      darkToggle.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleTheme(); } });

      // Navigation (kept)
      const navBubbles = document.querySelectorAll('.nav-bubble');
      const pageSections = document.querySelectorAll('.page-section');
      navBubbles.forEach(bubble => {
        bubble.addEventListener('click', function(e) {
          e.preventDefault();
          navBubbles.forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          pageSections.forEach(section => section.classList.remove('active'));
          const target = this.getAttribute('data-target');
          document.getElementById(target).classList.add('active');
        });
      });

      // Modal (kept)
      const modal = document.getElementById('page-modal');
      const modalTitle = document.getElementById('modal-title');
      const modalFrame = document.getElementById('profile-frame');
      const modalClose = document.querySelector('.modal-close');
      const forumNav = document.querySelector('[data-target="discussion-forum"]');
      const studyMaterialsNav = document.getElementById('study-materials-nav');
      const profileNav = document.getElementById('profile-nav');
      const profileDropdownLink = document.getElementById('profile-dropdown-link');
      const helpBtn = document.getElementById('request-help-btn');
      const uploadBtn = document.getElementById('upload-materials-btn');
      const fabButton = document.getElementById('fab-button');

      function openStudyMaterials() {
        modalFrame.src = 'study-materials.html';
        modalTitle.textContent = 'Study Materials';
        modal.style.display = 'flex';
      }
      function openProfile() {
        modalFrame.src = 'profile.html';
        modalTitle.textContent = 'User Profile';
        modal.style.display = 'flex';
      }
      function openEduConnect() {
        modalFrame.src = 'forum.html';
        modalTitle.textContent = 'EduConnect - Social Learning Platform';
        modal.style.display = 'flex';
      }

      studyMaterialsNav.addEventListener('click', function(e) { e.preventDefault(); openStudyMaterials(); });
      profileNav.addEventListener('click', function(e) { e.preventDefault(); openProfile(); });
      profileDropdownLink.addEventListener('click', function(e) { e.preventDefault(); openProfile(); });
      uploadBtn.addEventListener('click', function() { openStudyMaterials(); });
      fabButton.addEventListener('click', function() { openStudyMaterials(); });
      forumNav.addEventListener('click', function(e) { e.preventDefault(); openEduConnect(); });
      helpBtn.addEventListener('click', function() { openEduConnect(); });
      modalClose.addEventListener('click', function() { modal.style.display = 'none'; modalFrame.src = 'about:blank'; });
      modal.addEventListener('click', function(e) { if (e.target === modal) { modal.style.display = 'none'; modalFrame.src = 'about:blank'; } });

      // Profile dropdown (kept)
      const profileDropdown = document.querySelector('.profile-dropdown');
      profileDropdown.addEventListener('click', function(e) {
        e.stopPropagation();
        const menu = this.querySelector('.dropdown-menu');
        menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
      });
      document.addEventListener('click', function() {
        const menu = document.querySelector('.dropdown-menu');
        if (menu) menu.style.display = 'none';
      });

      // ----------- API INTEGRATIONS (no visual changes) -----------
      const API_BASE = (window.PEERCONNECT_API_BASE || '').replace(/\/+$/, ''); // trim trailing slash
      const headers = { 'Accept': 'application/json' };

      async function fetchJSON(path) {
        if (!API_BASE) return null; // no backend connected yet
        const res = await fetch(API_BASE + path, { headers });
        if (!res.ok) throw new Error('API error: ' + res.status);
        return res.json();
      }

      // Notifications
      (async () => {
        const container = document.getElementById('notifications-list');
        const empty = document.getElementById('notifications-empty');
        try {
          const data = await fetchJSON('/notifications?limit=5');
          container.innerHTML = '';
          if (!data || !data.length) {
            empty.style.display = 'block';
            return;
          }
          data.forEach(n => {
            const item = document.createElement('div');
            item.className = 'notification-item';
            item.innerHTML = `
              <i class="fas ${n.icon || 'fa-bell'}" aria-hidden="true"></i>
              <span>${n.text || ''}</span>
            `;
            container.appendChild(item);
          });
        } catch (e) {
          empty.style.display = 'block';
        }
      })();

// Trending Discussions
      (async () => {
        const container = document.getElementById('trending-list');
        const empty = document.getElementById('trending-empty');
        try {
          // ✅ call backend discussions API
          const data = await fetchJSON('/discussions/trending');
          container.innerHTML = '';

          if (!data || !data.success || !data.trending || data.trending.length === 0) {
            empty.style.display = 'block';
            return;
          }

          data.trending.forEach(d => {
            const item = document.createElement('div');
            item.className = 'notification-item';
            item.innerHTML = `
              <div style="flex:1;cursor:pointer">
                <strong>${d.title}</strong><br>
                <span class="muted">by ${d.stu_fname} ${d.stu_lname}</span>
              </div>
              <div class="muted small">
                ${d.views} views · ${d.likes} likes
              </div>
            `;
            item.onclick = () => {
              // Redirect to discussion page
              window.location.href = "forum.html?id=" + d.id;
            };
            container.appendChild(item);
          });
        } catch (e) {
          console.error("Trending fetch failed:", e);
          empty.style.display = 'block';
        }
      })();


      // Resources
      (async () => {
        const container = document.getElementById('resources-list');
        const empty = document.getElementById('resources-empty');
        try {
          const data = await fetchJSON('/resources?limit=5');
          container.innerHTML = '';
          if (!data || !data.length) {
            empty.style.display = 'block';
            return;
          }
          data.forEach(r => {
            const item = document.createElement('div');
            item.className = 'notification-item';
            item.innerHTML = r.url
              ? `<a href="${r.url}" target="_blank" rel="noopener">${r.title}</a>`
              : `<span>${r.title}</span>`;
            container.appendChild(item);
          });
        } catch (e) {
          empty.style.display = 'block';
        }
      })();

      // Progress
      (async () => {
        const meter = document.getElementById('progress-meter');
        const fill = document.getElementById('progress-fill');
        const text = document.getElementById('progress-text');
        try {
          const data = await fetchJSON('/progress');
          const percent = Math.max(0, Math.min(100, (data && data.percent) || 0));
          meter.style.display = 'block';
          requestAnimationFrame(() => { fill.style.width = percent + '%'; });
          text.textContent = percent + '% Complete';
        } catch (e) {
          text.textContent = 'No progress data yet.';
        }
      })();

      // (Optional) Notification badge count from API
      (async () => {
        const badge = document.getElementById('notificationBadge');
        try {
          const data = await fetchJSON('/notifications/unread-count');
          if (data && typeof data.count === 'number' && data.count > 0) {
            badge.style.width = 'auto';
            badge.style.height = 'auto';
            badge.style.padding = '2px 6px';
            badge.textContent = data.count;
          } else {
            badge.textContent = '';
          }
        } catch {
          badge.textContent = '';
        }
      })();
      // -----------------------------------------------------------
    });
  </script>

  <!-- Keep your existing external script if any -->
  <script src="config.js"></script>
  <script src="dashboard.js"></script>
</body>
</html>
